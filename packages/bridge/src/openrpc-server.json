{
  "openrpc": "1.0.0",
  "info": {
    "title": "Language Analyzer",
    "version": "1.0.0",
    "description": "Performs on-demand analysis of a single file using a saved analysis context."
  },
  "methods": [
    {
      "name": "analyze_file",
      "summary": "Analyze a file using a stored analysis context.",
      "description": "Performs analysis on the provided file content, leveraging the context identified by contextId. Returns issues and potential analysis problems.",
      "params": [
        {
          "name": "contextId",
          "description": "The unique ID of the analysis context to use.",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "filename",
          "description": "The name of the file being analyzed.",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "fileContent",
          "description": "The full content of the file to analyze.",
          "required": true,
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "activeRules",
          "description": "A list of rule keys (e.g., 'java:S1172') to activate for the analysis.",
          "required": true,
          "schema": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      ],
      "result": {
        "name": "AnalysisResult",
        "description": "The results of the file analysis, including issues",
        "schema": {
          "title": "AnalysisResult",
          "type": "object",
          "properties": {
            "issues": {
              "type": "array",
              "description": "A list of issues (code smells, bugs, vulnerabilities) found.",
              "items": {
                "$ref": "#/components/schemas/Issue"
              }
            },
            "analysisProblems": {
              "type": "array",
              "description": "High-level problems encountered during analysis (e.g., missing dependencies, configuration issues).",
              "items": {
                "type": "string"
              }
            }
          },
          "required": ["issues", "analysisProblems"]
        }
      },
      "errors": [
        {
          "$ref": "#/components/errors/ContextNotFound"
        },
        {
          "$ref": "#/components/errors/InvalidParameters"
        }
      ]
    }
  ],
  "components": {
    "schemas": {
      "TextRange": {
        "type": "object",
        "properties": {
          "startLine": {
            "type": "integer",
            "description": "The starting line number (1-indexed)."
          },
          "endLine": {
            "type": "integer",
            "description": "The ending line number (1-indexed)."
          },
          "startOffset": {
            "type": "integer",
            "description": "The starting character offset from the beginning of the file (0-indexed)."
          },
          "endOffset": {
            "type": "integer",
            "description": "The ending character offset from the beginning of the file (0-indexed)."
          }
        }
      },
      "FlowLocation": {
        "type": "object",
        "properties": {
          "textRange": {
            "$ref": "#/components/schemas/TextRange"
          },
          "message": {
            "type": "string",
            "description": "A description of the step in the flow."
          },
          "file": {
            "type": "string",
            "description": "The file path where this flow location exists."
          }
        }
      },
      "Flow": {
        "type": "object",
        "properties": {
          "locations": {
            "type": "array",
            "description": "Ordered steps of the data/control flow.",
            "items": {
              "$ref": "#/components/schemas/FlowLocation"
            }
          }
        }
      },
      "Issue": {
        "type": "object",
        "description": "A single analysis finding.",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique ID of the issue."
          },
          "filePath": {
            "type": "string",
            "description": "The path to the file containing the issue."
          },
          "message": {
            "type": "string",
            "description": "The descriptive message of the issue."
          },
          "rule": {
            "type": "string",
            "description": "The key of the rule that raised this issue."
          },
          "textRange": {
            "$ref": "#/components/schemas/TextRange"
          },
          "flows": {
            "type": "array",
            "description": "Optional list of data/control flow paths for security issues.",
            "items": {
              "$ref": "#/components/schemas/Flow"
            }
          }
        },
        "required": ["filePath", "message", "rule", "textRange"]
      }
    },
    "errors": {
      "ContextNotFound": {
        "code": -32001,
        "message": "Context Not Found",
        "data": {
          "type": "object",
          "properties": {
            "contextId": {
              "type": "string",
              "description": "The context ID that could not be found."
            }
          }
        }
      },
      "InvalidParameters": {
        "code": -32602,
        "message": "Invalid Parameters",
        "data": {
          "type": "object",
          "properties": {
            "details": {
              "type": "string",
              "description": "Details about which parameter was invalid."
            }
          }
        }
      }
    }
  }
}
